---
milestone: v1.2
audited: 2026-02-23T12:00:00Z
status: gaps_found
scores:
  requirements: 18/21
  phases: 3/4
  integration: 14/17
  flows: 2/5
gaps:
  requirements:
    - id: "QLT-01"
      status: "orphaned"
      phase: "Phase 6"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 6 (Frontend Integration) has no phase directory, no plans, no execution, and no verification. QLT-01 requires quality badges on ALL component pages (bullets, cartridges) — currently only powders page renders quality badges."
    - id: "SRC-04"
      status: "orphaned"
      phase: "Phase 6"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 6 not started. Simulation form still uses flat <Select> dropdowns. Backend search/filter API is ready but no searchable picker modals exist in frontend."
    - id: "SRC-05"
      status: "orphaned"
      phase: "Phase 6"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "orphaned"
      evidence: "Phase 6 not started. Frontend hooks discard total/page/size from paginated response. No pagination controls on any CRUD page. usePowders/useBullets/useCartridges always fetch page=1, size=50. With 208 powders, 158 are invisible."
  integration:
    - from: "frontend/src/lib/api.ts (importGrtPowders)"
      to: "backend/app/api/powders.py (import-grt)"
      issue: "Frontend sends ?overwrite=true but Phase 5 changed backend to ?mode=overwrite (ImportMode enum). Overwrite silently ignored, defaults to skip."
      severity: "critical"
      affected_requirements: ["PWD-01"]
    - from: "frontend/src/lib/types.ts (Bullet interface)"
      to: "backend/app/schemas/bullet.py (BulletCreate)"
      issue: "TypeScript declares length_mm and bc_g7 as required number, but backend now returns null for imported bullets missing these fields."
      severity: "high"
      affected_requirements: ["BUL-03"]
    - from: "docker-compose.yml (backend startup)"
      to: "backend/app/db/migrations/versions/006_search_and_pagination.py"
      issue: "create_all creates tables but not pg_trgm extension or GIN indexes. Fuzzy search crashes on fresh Docker boot without manual alembic upgrade head."
      severity: "critical"
      affected_requirements: ["SRC-02"]
  flows:
    - flow: "Fresh Docker boot -> search powders"
      breaks_at: "GET /powders?q=varget fails — pg_trgm extension not created by create_all"
      affected_requirements: ["SRC-02"]
    - flow: "GRT import with overwrite mode"
      breaks_at: "?overwrite=true silently ignored by backend, all collisions skipped"
      affected_requirements: ["PWD-01"]
    - flow: "User browses full powder list"
      breaks_at: "No pagination UI — only 50 of 208 powders visible"
      affected_requirements: ["SRC-01", "SRC-05"]
tech_debt:
  - phase: 03-schema-and-quality-system
    items: []
  - phase: 04-search-and-pagination
    items:
      - "Migration 006 cartridge caliber_family backfill uses bore_diameter_mm instead of groove_diameter_mm — affects DB upgrade path only, not fresh installs"
      - "pg_trgm fuzzy search untestable in SQLite test suite — code verified but runtime requires PostgreSQL"
  - phase: 05-import-pipelines-and-fixture-data
    items:
      - "All 208 fixture powders have web_thickness_mm: null — SOL-01 solver parameterization is wired but data-empty, always falls back to 0.0004m"
      - "198 of 208 fixture powders are data_source: estimated scoring ~27/100 (danger tier) — quality filtering returns mostly empty results for success/warning tiers"
      - "Frontend GrtImportResult TypeScript interface missing updated[] and mode fields added in Phase 5"
---

# Milestone v1.2 Audit Report: Component Databases + Search

**Milestone Goal:** Build comprehensive pre-loaded component databases with quality indicators, multi-source import pipelines, and advanced search/filtering so users can simulate immediately without manual data entry.

**Audited:** 2026-02-23
**Status:** GAPS FOUND
**Score:** 18/21 requirements satisfied

---

## Phase Verification Summary

| Phase | Name | Status | Verification | Requirements |
|-------|------|--------|--------------|--------------|
| 3 | Schema and Quality System | PASSED | 5/5 truths verified (2026-02-21) | 6/6 satisfied |
| 4 | Search and Pagination | PASSED | 12/12 truths verified (2026-02-21) | 3/3 satisfied |
| 5 | Import Pipelines and Fixture Data | PASSED | 12/12 truths verified (2026-02-22) | 9/9 satisfied |
| 6 | Frontend Integration | **NOT STARTED** | No directory, no plans | 0/3 — orphaned |

**Phase Coverage:** 3/4 phases completed. Phase 6 has no directory, no plans, no execution.

---

## Requirements Coverage (3-Source Cross-Reference)

### Phase 3 Requirements (6/6 Satisfied)

| REQ-ID | Description | VERIFICATION.md | REQUIREMENTS.md | Final |
|--------|-------------|-----------------|-----------------|-------|
| PWD-02 | Quality badges on powders | SATISFIED | `[x]` Complete | **satisfied** |
| PWD-03 | Quality score 0-100 with tooltip | SATISFIED | `[x]` Complete | **satisfied** |
| PWD-04 | Data source provenance tracking | SATISFIED | `[x]` Complete | **satisfied** |
| QLT-02 | Auto-recompute quality on PUT | SATISFIED | `[x]` Complete | **satisfied** |
| QLT-03 | Deterministic quality formula | SATISFIED | `[x]` Complete | **satisfied** |
| SOL-01 | Solver reads per-powder web_thickness | SATISFIED | `[x]` Complete | **satisfied** |

### Phase 4 Requirements (3/3 Satisfied)

| REQ-ID | Description | VERIFICATION.md | REQUIREMENTS.md | Final |
|--------|-------------|-----------------|-----------------|-------|
| SRC-01 | Server-side pagination on all endpoints | SATISFIED | `[x]` Complete | **satisfied** |
| SRC-02 | Fuzzy search with pg_trgm | SATISFIED | `[x]` Complete | **satisfied** |
| SRC-03 | Multi-field filtering | SATISFIED | `[x]` Complete | **satisfied** |

### Phase 5 Requirements (9/9 Satisfied)

| REQ-ID | Description | VERIFICATION.md | REQUIREMENTS.md | Final |
|--------|-------------|-----------------|-----------------|-------|
| PWD-01 | Batch import 200+ GRT powders with collision handling | SATISFIED | `[x]` Complete | **satisfied** |
| PWD-05 | Powder aliases resolved across markets | SATISFIED | `[x]` Complete | **satisfied** |
| BUL-01 | 100-200 pre-loaded bullets from major manufacturers | SATISFIED | `[x]` Complete | **satisfied** |
| BUL-02 | Extended bullet record fields | SATISFIED | `[x]` Complete | **satisfied** |
| BUL-03 | Nullable bullet fields with completeness indicators | SATISFIED | `[x]` Complete | **satisfied** |
| BUL-04 | Batch import bullets from JSON fixtures | SATISFIED | `[x]` Complete | **satisfied** |
| CRT-01 | 50+ pre-loaded cartridges with CIP/SAAMI specs | SATISFIED | `[x]` Complete | **satisfied** |
| CRT-02 | Cartridge parent lineage and extended dimensions | SATISFIED | `[x]` Complete | **satisfied** |
| CRT-03 | Batch import cartridges from JSON fixtures | SATISFIED | `[x]` Complete | **satisfied** |

### Phase 6 Requirements (0/3 — Orphaned)

| REQ-ID | Description | Status | Reason |
|--------|-------------|--------|--------|
| QLT-01 | Quality badges on ALL component pages | **orphaned** | Phase 6 not started. Backend data available but bullets/cartridges pages render no badges. |
| SRC-04 | Searchable picker modals in simulation form | **orphaned** | Phase 6 not started. Simulation form uses flat `<Select>` dropdowns limited to 50 items. |
| SRC-05 | Frontend pagination with keepPreviousData | **orphaned** | Phase 6 not started. No pagination controls. 158/208 powders and 77/127 bullets invisible in UI. |

**Note:** SUMMARY frontmatter `requirements_completed` field was absent from all 7 plan summaries. Cross-reference based on 2 sources (VERIFICATION + REQUIREMENTS.md traceability).

---

## Cross-Phase Integration

**Score:** 14/17 exports wired correctly

### Verified Wiring

- **Phase 3 -> Phase 4:** `compute_quality_score()` extended with `compute_bullet_quality_score()` and `compute_cartridge_quality_score()`. All three entity endpoints auto-compute quality on create/update.
- **Phase 4 -> Phase 5:** `paginate()` and `apply_fuzzy_search()` wired in all list endpoints. `derive_caliber_family()` called on all create/update/seed paths.
- **Phase 5 -> Phase 4:** `ImportMode` and `ImportResult` schemas re-imported by bullets/cartridges. Newly imported records immediately get quality scores and are searchable.
- **Phase 3 -> Phase 5:** Quality scorer `BONUS_FIELDS` expanded for bullet (5 fields) and cartridge (8 fields). Fixture data populates all bonus fields where available.
- **Phase 3 -> Solver:** `_make_params()` reads `powder_row.web_thickness_mm` with 0.0004m fallback. All simulation endpoints use this path.
- **Phase 4 -> Frontend:** `usePowders/useBullets/useCartridges` hooks unwrap `.items` from paginated response. Simulation form dropdowns populated correctly (limited to page 1).
- **Phase 5 -> Seed:** `initial_data.py` loads from JSON fixtures, computes quality/caliber for all records, applies alias groups. Migration chain 005->006->007 intact.

### Critical Integration Issues

| # | Issue | From -> To | Severity | REQs |
|---|-------|-----------|----------|------|
| 1 | **pg_trgm not bootstrapped on Docker boot** — `create_all` creates tables but not pg_trgm extension or GIN indexes. Any `?q=` search crashes. | Docker startup -> migration 006 | Critical | SRC-02 |
| 2 | **GRT import mode parameter mismatch** — `api.ts` sends `?overwrite=true` but backend expects `?mode=overwrite` (ImportMode). Overwrite silently ignored. | frontend/api.ts -> api/powders.py | Critical | PWD-01 |
| 3 | **TypeScript nullable mismatch** — `Bullet.length_mm` and `bc_g7` typed as required `number` in frontend but nullable in backend after Phase 5. | frontend/types.ts -> schemas/bullet.py | High | BUL-03 |

---

## E2E Flow Verification

**Score:** 2/5 flows complete

| Flow | Status | Break Point |
|------|--------|-------------|
| Fresh Docker boot -> seed -> list powders (no search) | COMPLETE | — |
| Fresh Docker boot -> search powders (`?q=varget`) | BROKEN | pg_trgm extension not created by `create_all` |
| GRT import with overwrite mode | BROKEN | `?overwrite=true` silently ignored, defaults to `skip` |
| User browses full powder list (208 records) | BROKEN | No pagination UI, only 50 of 208 visible |
| Fresh boot WITH Alembic -> search -> simulate | COMPLETE | Works if `alembic upgrade head` run first |

---

## Tech Debt Summary

### Phase 4: Search and Pagination
1. Migration 006 cartridge `caliber_family` backfill uses `bore_diameter_mm` instead of `groove_diameter_mm` — affects DB upgrade path only, not fresh installs
2. pg_trgm fuzzy search untestable in SQLite test suite — code verified but runtime requires PostgreSQL

### Phase 5: Import Pipelines and Fixture Data
1. All 208 fixture powders have `web_thickness_mm: null` — SOL-01 solver parameterization wired but data-empty, always falls back to 0.0004m
2. 198/208 fixture powders are `data_source: "estimated"` scoring ~27/100 (danger tier) — quality filtering for success/warning tiers returns near-empty results
3. Frontend `GrtImportResult` TypeScript interface missing `updated[]` and `mode` fields added in Phase 5

**Total:** 5 items across 2 phases (non-blocking)

---

## Test Suite Status

| Phase | Tests Added | Suite Total | Status |
|-------|-------------|-------------|--------|
| Phase 3 | 15 (10 unit + 5 integration) | 270 | All passing |
| Phase 4 | 22 (pagination + filters) | 292 | All passing |
| Phase 5 | 25 (fixtures + imports + seed) | 317 | All passing |

---

_Audited: 2026-02-23T12:00:00Z_
_Auditor: Claude (gsd-audit-milestone)_
