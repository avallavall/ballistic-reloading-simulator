---
phase: 06-frontend-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/ui/QualityBadge.tsx
  - frontend/src/components/ui/Pagination.tsx
  - frontend/src/components/ui/SkeletonRows.tsx
  - frontend/src/components/ui/Toast.tsx
  - frontend/src/hooks/useDebounce.ts
  - frontend/src/lib/api.ts
  - frontend/src/hooks/usePowders.ts
  - frontend/src/hooks/useBullets.ts
  - frontend/src/hooks/useCartridges.ts
autonomous: true
requirements:
  - QLT-01
  - SRC-04
  - SRC-05

must_haves:
  truths:
    - "QualityBadge renders colored dot + text label + hover tooltip for any component type"
    - "Pagination component renders page controls with prev/next, page numbers, and items-per-page selector"
    - "API functions accept optional page/size/q parameters and build URL query strings"
    - "Paginated hooks use keepPreviousData for smooth transitions without breaking existing hooks"
    - "useDebounce hook delays value changes by configurable delay"
    - "SkeletonRows renders animated placeholder rows while data loads"
    - "Toast component shows non-blocking auto-dismiss error notifications"
  artifacts:
    - path: "frontend/src/components/ui/QualityBadge.tsx"
      provides: "Reusable quality badge with colored dot, label, and CSS-only hover tooltip"
      min_lines: 25
    - path: "frontend/src/components/ui/Pagination.tsx"
      provides: "Page controls with prev/next arrows, page numbers, and size selector"
      min_lines: 40
    - path: "frontend/src/components/ui/SkeletonRows.tsx"
      provides: "3-5 animated placeholder table rows for loading state"
      min_lines: 15
    - path: "frontend/src/components/ui/Toast.tsx"
      provides: "Non-blocking error toast with auto-dismiss after 5 seconds"
      min_lines: 30
    - path: "frontend/src/hooks/useDebounce.ts"
      provides: "Custom debounce hook for search input delay"
      min_lines: 10
    - path: "frontend/src/lib/api.ts"
      provides: "getPowders/getBullets/getCartridges with optional ListParams"
      contains: "URLSearchParams"
    - path: "frontend/src/hooks/usePowders.ts"
      provides: "usePowdersPaginated hook alongside existing usePowders"
      contains: "keepPreviousData"
    - path: "frontend/src/hooks/useBullets.ts"
      provides: "useBulletsPaginated hook alongside existing useBullets"
      contains: "keepPreviousData"
    - path: "frontend/src/hooks/useCartridges.ts"
      provides: "useCartridgesPaginated hook alongside existing useCartridges"
      contains: "keepPreviousData"
  key_links:
    - from: "frontend/src/hooks/usePowders.ts"
      to: "frontend/src/lib/api.ts"
      via: "getPowders with ListParams"
      pattern: "getPowders.*page.*size"
    - from: "frontend/src/hooks/usePowders.ts"
      to: "@tanstack/react-query"
      via: "placeholderData: keepPreviousData"
      pattern: "placeholderData.*keepPreviousData"
---

<objective>
Build the reusable UI components and data-fetching infrastructure needed by the quality badges, pagination, and picker modal features.

Purpose: All three Phase 6 requirements (QLT-01, SRC-04, SRC-05) share common building blocks: QualityBadge for badge display, Pagination for page controls, useDebounce for search input, API functions with query params, and paginated hooks with keepPreviousData. Building these in a dedicated plan avoids duplication and ensures a clean foundation.

Output: 5 new component/hook files, 3 modified API functions, 3 modified hook files, all type-safe and backward-compatible.
</objective>

<execution_context>
@C:/Users/vall-/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/vall-/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-frontend-integration/06-CONTEXT.md
@.planning/phases/06-frontend-integration/06-RESEARCH.md
@frontend/src/lib/api.ts
@frontend/src/lib/types.ts
@frontend/src/hooks/usePowders.ts
@frontend/src/hooks/useBullets.ts
@frontend/src/hooks/useCartridges.ts
@frontend/src/components/ui/Badge.tsx
@frontend/src/app/powders/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reusable UI components (QualityBadge, Pagination, SkeletonRows, Toast, useDebounce)</name>
  <files>
    frontend/src/components/ui/QualityBadge.tsx
    frontend/src/components/ui/Pagination.tsx
    frontend/src/components/ui/SkeletonRows.tsx
    frontend/src/components/ui/Toast.tsx
    frontend/src/hooks/useDebounce.ts
  </files>
  <action>
Create 5 new files:

**1. `frontend/src/components/ui/QualityBadge.tsx`**
Extract the quality badge pattern from powders/page.tsx (lines 706-715) into a reusable component.
- Props: `score: number`, `level: string` (maps to Badge variant: success/warning/danger), `tooltip: string`
- Per user decision: colored dot (h-2 w-2 rounded-full) + text label in Badge component + CSS-only hover tooltip
- Dot colors: `success` -> `bg-green-400`, `warning` -> `bg-yellow-400`, `danger` -> `bg-red-400`
- Labels in Spanish: `success` -> "Completo", `warning` -> "Parcial", `danger` -> "Minimo"
- Tooltip: uses existing `group-hover:opacity-100` pattern (CSS-only, no library)
- Handle undefined/missing quality fields gracefully: if score is undefined, render a `default` badge with text "N/D"
- Import and use the existing Badge component from `@/components/ui/Badge`

**2. `frontend/src/components/ui/Pagination.tsx`**
Create pagination controls per user decisions:
- Props: `page: number`, `totalPages: number`, `size: number`, `onPageChange: (page: number) => void`, `onSizeChange: (size: number) => void`
- Render: prev arrow button (disabled on page 1) + page number buttons (1, 2, ..., N with ellipsis for >5 pages) + next arrow button (disabled on last page)
- Items-per-page selector: `<select>` with options 10, 20, 50 (default 20)
- Use lucide-react ChevronLeft/ChevronRight icons for arrows
- Tailwind styling: dark theme consistent with app (bg-slate-800, text-slate-300, active page bg-blue-600)
- Position: designed to sit at bottom of table

**3. `frontend/src/components/ui/SkeletonRows.tsx`**
Create skeleton loading rows per user decisions:
- Props: `columns: number` (number of table columns to span), `rows?: number` (default 5)
- Render: `<TableRow>` elements with `<TableCell>` containing `<div className="h-4 bg-slate-700 rounded animate-pulse">`
- Use Tailwind `animate-pulse` (built-in, no custom keyframes)
- Import TableRow/TableCell from `@/components/ui/Table`
- Vary skeleton widths slightly across columns for visual variety (e.g., w-24, w-32, w-20, w-16 cycling)

**4. `frontend/src/components/ui/Toast.tsx`**
Create a minimal toast notification component:
- Exported function `showToast(message: string, type?: 'error' | 'info')` that renders a toast
- Position: top-right of viewport using fixed positioning
- Auto-dismiss after 5 seconds per user decision
- Non-blocking: does not prevent user interaction
- Implementation: Use ReactDOM.createRoot or a simple state-based approach. Simplest: export a `ToastContainer` component that renders via React portal, and a `useToast()` hook that manages toast state. The hook returns `{ showToast, ToastContainer }`.
- Styling: error = red border + red text, info = blue border + blue text, dark background (bg-slate-800), rounded, shadow-lg
- Animate in/out with opacity transition

**5. `frontend/src/hooks/useDebounce.ts`**
Create a custom debounce hook:
- `export function useDebounce<T>(value: T, delay: number = 300): T`
- Uses useState + useEffect with setTimeout
- CRITICAL: Returns cleanup function `() => clearTimeout(timer)` in useEffect to prevent memory leaks
- 300ms default per user decision (configurable via parameter)
  </action>
  <verify>
    <automated>cd C:/Users/vall-/Desktop/projectes/simulador_balistica/frontend && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>Check that all 5 files exist and have no TypeScript errors</manual>
  </verify>
  <done>
    - QualityBadge renders dot + label + hover tooltip for all three quality levels
    - Pagination renders prev/next + page numbers + size selector
    - SkeletonRows renders configurable animated placeholder rows
    - Toast provides non-blocking auto-dismiss error notifications
    - useDebounce delays value with configurable delay and proper cleanup
  </done>
</task>

<task type="auto">
  <name>Task 2: Add query param support to API functions and create paginated hooks</name>
  <files>
    frontend/src/lib/api.ts
    frontend/src/hooks/usePowders.ts
    frontend/src/hooks/useBullets.ts
    frontend/src/hooks/useCartridges.ts
  </files>
  <action>
Modify 4 existing files:

**1. `frontend/src/lib/api.ts`** — Add ListParams interface and modify 3 functions

Add a `ListParams` interface near the top (after imports):
```typescript
export interface ListParams {
  page?: number;
  size?: number;
  q?: string;
}
```

Add a helper to build query strings:
```typescript
function buildQueryString(params: ListParams): string {
  const sp = new URLSearchParams();
  if (params.page) sp.set('page', String(params.page));
  if (params.size) sp.set('size', String(params.size));
  if (params.q && params.q.length >= 3) sp.set('q', params.q);
  const qs = sp.toString();
  return qs ? `?${qs}` : '';
}
```

CRITICAL: Only send `q` when length >= 3 (backend declares `min_length=3` and returns 422 for shorter strings). This prevents 422 errors when user types 1-2 characters.

Modify `getPowders`, `getBullets`, `getCartridges` to accept optional `ListParams`:
- `export async function getPowders(params: ListParams = {}): Promise<PaginatedResponse<Powder>>`
- Same pattern for getBullets and getCartridges
- Append `buildQueryString(params)` to the endpoint path
- CRITICAL: When called with no params (`getPowders()`), the function must still work exactly as before (returns first page, default size). This preserves backward compatibility for existing hooks.

**2. `frontend/src/hooks/usePowders.ts`** — Add paginated hook

Keep the existing `usePowders()` hook UNCHANGED (it uses `select: (data) => data.items` for backward compat with SimulationForm, LadderTest, ParametricSearch).

Add new export:
```typescript
import { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';
import type { ListParams } from '@/lib/api';

export function usePowdersPaginated(params: ListParams = {}) {
  const { page = 1, size = 20, q } = params;
  return useQuery({
    queryKey: ['powders', 'list', { page, size, q }],
    queryFn: () => getPowders({ page, size, q }),
    placeholderData: keepPreviousData,
  });
}
```

IMPORTANT: Use a distinct queryKey prefix `['powders', 'list', ...]` so paginated queries don't conflict with the existing `['powders']` key used by `usePowders()`. This prevents cache collisions.

**3. `frontend/src/hooks/useBullets.ts`** — Add paginated hook

Same pattern as powders: keep existing `useBullets()` unchanged, add `useBulletsPaginated(params)` with `keepPreviousData` and `['bullets', 'list', { page, size, q }]` queryKey.

Import `keepPreviousData` from `@tanstack/react-query` and `ListParams` + `getBullets` from api.

**4. `frontend/src/hooks/useCartridges.ts`** — Add paginated hook

Same pattern: keep existing `useCartridges()` unchanged, add `useCartridgesPaginated(params)` with `keepPreviousData` and `['cartridges', 'list', { page, size, q }]` queryKey.
  </action>
  <verify>
    <automated>cd C:/Users/vall-/Desktop/projectes/simulador_balistica/frontend && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>Verify that existing hooks still compile and new paginated hooks export correctly</manual>
  </verify>
  <done>
    - getPowders/getBullets/getCartridges accept optional ListParams and build URL query strings
    - q param only sent when >= 3 characters (prevents 422 errors)
    - Calling these functions with no params works identically to before (backward compat)
    - usePowdersPaginated, useBulletsPaginated, useCartridgesPaginated exported with keepPreviousData
    - Existing usePowders/useBullets/useCartridges hooks remain unchanged
    - No TypeScript compilation errors
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors in frontend/
2. All 5 new files exist: QualityBadge.tsx, Pagination.tsx, SkeletonRows.tsx, Toast.tsx, useDebounce.ts
3. All 4 modified files compile: api.ts, usePowders.ts, useBullets.ts, useCartridges.ts
4. Existing hooks (usePowders, useBullets, useCartridges) still export and function unchanged
5. New paginated hooks use `placeholderData: keepPreviousData` (v5 syntax, not v4)
</verification>

<success_criteria>
- 5 new reusable components/hooks created with correct TypeScript types
- 3 API functions accept optional ListParams with query string building
- 3 new paginated hook variants exported alongside existing hooks
- Zero TypeScript compilation errors
- No breaking changes to existing pages (SimulationForm, LadderTest, ParametricSearch, CRUD pages)
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-integration/06-01-SUMMARY.md`
</output>
